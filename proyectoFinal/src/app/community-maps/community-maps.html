<div class="maps-container">
  <div class="maps-header">
    <button class="back-button" (click)="goBack()">
      ← Volver a Comunidad
    </button>
    <h1 class="page-title">Mapas de la Comunidad</h1>
    <p class="subtitle">Explora y juega los mapas creados por la comunidad</p>
    <div class="search-container">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          class="search-input"
          [(ngModel)]="searchQuery"
          placeholder="Buscar por nombre, autor o descripción..."
        />
        <button 
          class="clear-button" 
          *ngIf="searchQuery"
          (click)="clearSearch()"
        >
          ✕
        </button>
      </div>
      <div class="search-results" *ngIf="searchQuery">
        <span class="results-count">{{ filteredMaps.length }} resultado(s) encontrado(s)</span>
      </div>
    </div>
  </div>
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner-large"></div>
    <p>Cargando mapas...</p>
  </div>
  <div class="maps-grid" *ngIf="!isLoading">
    <div class="empty-state" *ngIf="maps.length === 0 && !searchQuery">
      <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
          <line x1="8" y1="2" x2="8" y2="18"></line>
          <line x1="16" y1="6" x2="16" y2="22"></line>
        </svg>
      </div>
      <h2>No hay mapas disponibles</h2>
      <p>Sé el primero en crear y compartir un mapa con la comunidad.</p>
      <p class="coming-soon">La funcionalidad de crear mapas estará disponible próximamente.</p>
    </div>
    <div class="empty-state" *ngIf="searchQuery && filteredMaps.length === 0">
      <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </div>
      <h2>No se encontraron mapas</h2>
      <p>No hay mapas que coincidan con "{{ searchQuery }}"</p>
      <button class="clear-search-button" (click)="clearSearch()">Limpiar búsqueda</button>
    </div>
    <div class="map-card" *ngFor="let map of filteredMaps">
      <div class="map-preview">
        <img [src]="getMapImageUrl(map)" [alt]="map.name" class="map-image" />
      </div>
      <div class="map-info">
        <h3 class="map-name">{{ map.name }}</h3>
        <p class="map-author">Por: {{ map.authorUsername }}</p>
        <p class="map-description">{{ map.description }}</p>
        <div class="map-stats">
          <span class="stat">
            <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
              <polyline points="17 2 12 7 7 2"></polyline>
            </svg>
            {{ map.plays }} jugadas
          </span>
          <button 
            class="upvote-button" 
            [class.upvoted]="map.hasUpvoted"
            (click)="toggleUpvote(map)"
            title="Me gusta"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" [attr.fill]="map.hasUpvoted ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2">
              <path d="M7 22V11M2 13V20C2 21.1046 2.89543 22 4 22H17.4262C18.907 22 20.1662 20.9197 20.3914 19.4562L21.4683 12.4562C21.7479 10.6389 20.3418 9 18.5032 9H15V4C15 2.89543 14.1046 2 13 2C12.4477 2 12 2.44772 12 3V3.44885C12 3.79445 11.8683 4.12515 11.6325 4.37235L8.8944 7.23809C8.3314 7.83913 8 8.63753 8 9.47075V11"></path>
            </svg>
            <span>{{ map.upvotes || 0 }}</span>
          </button>
        </div>
        <button 
          class="download-button-full" 
          [class.saved]="isMapDownloaded(map._id)"
          (click)="toggleDownload(map)"
          [title]="isMapDownloaded(map._id) ? 'Remove from my maps' : 'Save map'"
        >
          <svg *ngIf="!isMapDownloaded(map._id)" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
          </svg>
          <svg *ngIf="isMapDownloaded(map._id)" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
          </svg>
          {{ isMapDownloaded(map._id) ? 'Saved' : 'Save' }}
        </button>
      </div>
    </div>
  </div>
</div>
